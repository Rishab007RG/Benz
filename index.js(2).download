/*! datapump 2.10.0-SNAPSHOT */
function i(i,t,e,n){return new(e||(e=Promise))((function(o,s){function r(i){try{a(n.next(i))}catch(i){s(i)}}function d(i){try{a(n.throw(i))}catch(i){s(i)}}function a(i){var t;i.done?o(i.value):(t=i.value,t instanceof e?t:new e((function(i){i(t)}))).then(r,d)}a((n=n.apply(i,t||[])).next())}))}
/*! logger 5.2.0-SNAPSHOT */const t="seamless-logger";var e;!function(i){i.dev="dev",i.test="test",i.int="int",i.pprod="pprod",i.prod="prod"}(e||(e={}));class SeamlessLogger{constructor(){var i,t;this.namespaceMap=new Map,this.isProdEnvironment="PUBLISH"===(null===(t=null===(i=window.aemNamespace)||void 0===i?void 0:i.environmentVariables)||void 0===t?void 0:t.runMode)&&window.aemNamespace.environmentVariables.stageVariant===e.prod,this.checkEnvironment(),this.config=function(){const i=localStorage.getItem("loggerDebugNamespaces");return{debugNamespaces:i?i.split(","):[]}}(),this.version="5.2.0-SNAPSHOT"}static disabledMethod(){}addNamespace(i){if(!this.namespaceMap.has(i)){const t=(1048575&(i=>{let t=0;for(let e=0;e<i.length;e++)t=i.charCodeAt(e)+((t<<5)-t);return t})(i)).toString(16).toUpperCase().padStart(6,"0");this.namespaceMap.set(i,{color:t,isDebugEnabled:this.isDebugEnabledForNamespace(i)})}}getNamespacedInstance(i){let e;return i&&this.namespaceMap.has(i)?e=i:(!this.namespaceMap.has(t)&&this.addNamespace(t),e=t),{error:this.error(e),log:this.loggerPermissionHandler(e,"log"),warn:this.loggerPermissionHandler(e,"warn"),debug:this.loggerPermissionHandler(e,"debug"),table:(...i)=>this.loggerPermissionHandler(e,"table",i),clear:this.clear,version:this.version}}checkEnvironment(){this.isProdEnvironment&&this.logMessageOnProd()}isDebugEnabledForNamespace(i){return this.config.debugNamespaces.includes(i)}loggerPermissionHandler(i,t,e){const n=this.namespaceMap.get(i);return!this.isProdEnvironment||(null==n?void 0:n.isDebugEnabled)?this.bindConsole(t,i,n?n.color:"",e):SeamlessLogger.disabledMethod}bindConsole(i,t,e,n){let o;switch(i){case"table":console.table(...n),o=SeamlessLogger.disabledMethod;break;case"log":case"debug":case"warn":o=console[i].bind(console,`%c[${t.toUpperCase()}]`,this.generateNamespaceStyle(e));break;default:o=SeamlessLogger.disabledMethod}return o}logMessageOnProd(){console.log("%c⚠️ [seamless-web] ⚠️ \nLogs are disabled on this environment by default.\nThis feature is for developers only. do not use this unless you know what you are doing.","background: black; color: white; padding: 10px; border: 2px solid black ; font-size: 18px;font-family: monospace; font-weight: bold;")}generateNamespaceStyle(i){return(i?`background: #${i};`:"")+" font-size: 14px; font-weight:bold; color: white; -webkit-text-stroke:.6px black;"}error(i){const t=this.namespaceMap.get(i);return console.error.bind(console,`%c[${i.toUpperCase()}]`,this.generateNamespaceStyle(null==t?void 0:t.color))}clear(){console.clear()}}const n=window.top||window,o=i=>(n.seamlessLogger||(n.seamlessLogger={seamlessLoggerInstance:new SeamlessLogger,initializeLogger:o}),i&&n.seamlessLogger.seamlessLoggerInstance.addNamespace(i),n.seamlessLogger.seamlessLoggerInstance.getNamespacedInstance(i))
/*! connection-wko-manager 1.6.0-SNAPSHOT */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */;function s(i,t,e,n){return new(e||(e=Promise))((function(o,s){function r(i){try{a(n.next(i))}catch(i){s(i)}}function d(i){try{a(n.throw(i))}catch(i){s(i)}}function a(i){var t;i.done?o(i.value):(t=i.value,t instanceof e?t:new e((function(i){i(t)}))).then(r,d)}a((n=n.apply(i,t||[])).next())}))}const r={Authentication:null,Locale:null,Environment:null,DealerContext:null,ConsentList:[],User:null},d="OWC_WKO",a="UPDATE_WKO",c=new class extends window.top.seamlessStore.SeamlessConnection{constructor(){super(d)}get initialState(){return r}getReducer(){return(i=r,t)=>t.type===this.getActionType(a)?Object.assign(Object.assign({},i),{[t.payload.name]:t.payload.value}):i}getPublicDispatchers(){return{setWko:i=>this.getAction(a,i)}}},l=()=>s(void 0,void 0,void 0,(function*(){const i=window.top.seamlessStore.initializeStore();return yield i.getConnectionDispatchers(d)})),u="ow_aem",v={authentication:{jwe:`${u}_jwe`,jwt:`${u}_jwt`,token:`${u}_sub`,roles:`${u}_roles`},user:{personal:{name:`${u}_name`,firstname:`${u}_firstname`,lastname:`${u}_lastname`,gender:`${u}_gender`,email:`${u}_email`,phone:`${u}_phone`,roles:`${u}_roles`,wkoUserData:`${u}_wkoUserData`},associatedVehicles:`${u}_userAssociatedVehicles`,associatedDealers:`${u}_userAssociatedDealers`,selectedAssociatedVehicle:`${u}_selectedAssociatedVehicle`,consent:{dataUsageScopes:`${u}_dataUsageScopes`,enableDataUsages:`${u}_enableDataUsages`}}},h="OWC_AEM_ENV";var f;new class extends window.top.seamlessStore.SeamlessConnection{constructor(){super(h)}get initialState(){var i,t,e,n,o,s;const r=(null===(i=window.aemNamespace)||void 0===i?void 0:i.environmentVariables)||(null===(e=null===(t=window.top)||void 0===t?void 0:t.aemNamespace)||void 0===e?void 0:e.environmentVariables),d=(null===(n=window.aemNamespace)||void 0===n?void 0:n.pageEnvironmentVariables)||(null===(s=null===(o=window.top)||void 0===o?void 0:o.aemNamespace)||void 0===s?void 0:s.pageEnvironmentVariables);return r&&d?Object.assign(Object.assign({},r),d):{}}getReducer(){return()=>this.initialState}getPublicDispatchers(){return{}}},function(i){i.local="local",i.session="session"}(f||(f={}));class BrowserStorageUtils{constructor(i){this.loggingEnabled=!1,this.logger=o("OWC FE LIBS"),window.top.seamlessStore.initializeStore().subscribe(h,(i=>{"prod"!==i.stageVariant&&(this.loggingEnabled=!0)})),this.t=i}get storage(){return this.t===f.local?window.localStorage:window.sessionStorage}getItem(i){return s(this,void 0,void 0,(function*(){const t=this.storage.getItem(i);if(this.loggingEnabled&&this.logger.log(`${this.t} : getItem : key: ${i}`),null==t)return this.loggingEnabled&&this.logger.warn(`${this.storage} : could not find key: ${i}`),null;try{return JSON.parse(t)}catch(e){return this.loggingEnabled&&this.logger.warn(`${this.storage} : could not convert "${i}" to JSON, returning it as is`),t}}))}}const g="Authentication",w="Locale",m="Environment",y="User",p="ConsentList";var b,S,A,P,_;!function(i){i.SALES="SALES",i.SERVICE="SERVICE"}(b||(b={}));class LoginChecks{constructor(){this.sessionStorage=new BrowserStorageUtils("session"),this.user={},this.authentication={},this.init()}init(){return s(this,void 0,void 0,(function*(){this.wkoManagerDispatchers=yield l(),this.initializeLoginchecks()}))}getStoredValues(i){return s(this,void 0,void 0,(function*(){const t=Object.keys(i),e=Object.values(i),n=t.reduce(((i,t,n)=>s(this,void 0,void 0,(function*(){const o=yield i,s=yield this.sessionStorage.getItem(e[n]);return null==s?o:Object.assign(Object.assign({},o),{[t]:s})}))),Promise.resolve({}));return yield n}))}getAuthentication(){return s(this,void 0,void 0,(function*(){return yield this.getStoredValues(v.authentication)}))}getUserPersonalData(){return s(this,void 0,void 0,(function*(){return yield this.getStoredValues(v.user.personal)}))}getUserConsent(){return s(this,void 0,void 0,(function*(){return yield this.getStoredValues(v.user.consent)}))}getSelectedAssociatedVehicle(){return s(this,void 0,void 0,(function*(){return yield this.sessionStorage.getItem(v.user.selectedAssociatedVehicle)}))}getUserAssociatedVehicles(){return s(this,void 0,void 0,(function*(){return yield this.sessionStorage.getItem(v.user.associatedVehicles)}))}getUserAssociatedDealers(){return s(this,void 0,void 0,(function*(){return yield this.sessionStorage.getItem(v.user.associatedDealers)}))}getUserSelectedAssociatedDealer(i){var t;const e=null===(t=i.selectedAssociatedVehicle)||void 0===t?void 0:t.finOrVin;if(i.selectedAssociatedVehicle&&i.userAssociatedDealers&&e){const t=i.userAssociatedDealers[e];if(t)return t.reduce(((i,t)=>(t.dealerType===b.SALES?i.salesDealer=t:t.dealerType===b.SERVICE&&(i.serviceDealer=t),i)),{})}return{}}getLoginchecksObject(){return s(this,void 0,void 0,(function*(){const i=yield Promise.all([this.getAuthentication(),this.getUserPersonalData(),this.getUserAssociatedVehicles(),this.getSelectedAssociatedVehicle(),this.getUserAssociatedDealers(),this.getUserConsent()]);return{authentication:i[0],userPersonalData:i[1],associatedVehicles:i[2],selectedAssociatedVehicle:i[3],userAssociatedDealers:i[4],userConsent:i[5]}}))}updateStore(i,t){this.wkoManagerDispatchers.setWko({name:i,value:t})}generateLoginchecksWkos(){return s(this,void 0,void 0,(function*(){const i=yield this.getLoginchecksObject(),t=this.getUserSelectedAssociatedDealer(i);this.user={personal:i.userPersonalData,associatedVehicles:i.associatedVehicles,selectedAssociatedVehicle:i.selectedAssociatedVehicle,selectedAssociatedDealer:t,associatedDealers:i.userAssociatedDealers,consent:i.userConsent},this.authentication=i.authentication}))}initializeLoginchecks(){return s(this,void 0,void 0,(function*(){this.generateLoginchecksWkos().then((()=>{this.updateStore(g,this.authentication),this.updateStore(y,this.user),this.addWkoManagerListener()}))}))}addWkoManagerListener(){window.addEventListener("wko-manager-update",(()=>s(this,void 0,void 0,(function*(){yield this.generateLoginchecksWkos(),this.updateStore(y,this.user)}))))}}!function(i){i.ucEvents="ucEvents",i.ucEventsUpdated="usercentrics-consents-updated"}(S||(S={}));class ConsentList{constructor(){this.getUserCentrics=()=>window.usercentrics?window.usercentrics.getConsents().map((i=>({name:i.dataProcessingService,enabled:i.consentStatus}))):[],this.cmpv1Listener=()=>{const i=this.getUserCentrics();this.wkoManagerConnection.setWko({name:p,value:i})},this.cmpv2Listener=i=>{i.detail&&i.detail.consents&&this.wkoManagerConnection.setWko({name:p,value:i.detail.consents})},this.init(),this.addEventListeners()}init(){return s(this,void 0,void 0,(function*(){this.wkoManagerConnection=yield l()}))}addEventListeners(){window.usercentrics?window.addEventListener(S.ucEvents,this.cmpv1Listener):window.addEventListener(S.ucEventsUpdated,this.cmpv2Listener)}}class WKOManager{constructor(){this.store=window.top.seamlessStore.initializeStore(),this.initializeWkoManager()}initializeWkoManager(){return s(this,void 0,void 0,(function*(){const i=yield l();this.store.subscribe(h,(t=>{i.setWko({name:m,value:t}),i.setWko({name:w,value:{country:t.country,language:t.language}})})),this.store.subscribe(d,(i=>{this.allWkos=i})),this.loginChecks=new LoginChecks,this.consentList=new ConsentList}))}}
/*! connection-aem-environment 1.6.0-SNAPSHOT */
function k(i,t,e,n){return new(e||(e=Promise))((function(o,s){function r(i){try{a(n.next(i))}catch(i){s(i)}}function d(i){try{a(n.throw(i))}catch(i){s(i)}}function a(i){var t;i.done?o(i.value):(t=i.value,t instanceof e?t:new e((function(i){i(t)}))).then(r,d)}a((n=n.apply(i,t||[])).next())}))}!function(i){i.LOCAL="LOCAL",i.TEST="TEST",i.DEV="DEV",i.INT="INT",i.PPROD="PPROD",i.PROD="PROD"}(A||(A={})),function(i){i.AFFINITY_SCORE="AFFINITY_SCORE"}(P||(P={})),function(i){i.MMVVS="MMV-VS",i.TOUCHPOINTS="MM-CONSID_TOUCHPOINTS",i.TSS_WISHLIST="TSS_WISHLIST-SAVED-PRODUCTS",i.MM_CONSID_VEHICLES="MM-CONSID_VEHICLES",i.B2XCORE_LOGIN="B2XCORE_USER_LOGIN"}(_||(_={}));const O="OWC_AEM_ENV",M=new class extends window.top.seamlessStore.SeamlessConnection{constructor(){super(O)}get initialState(){var i,t,e,n,o,s;const r=(null===(i=window.aemNamespace)||void 0===i?void 0:i.environmentVariables)||(null===(e=null===(t=window.top)||void 0===t?void 0:t.aemNamespace)||void 0===e?void 0:e.environmentVariables),d=(null===(n=window.aemNamespace)||void 0===n?void 0:n.pageEnvironmentVariables)||(null===(s=null===(o=window.top)||void 0===o?void 0:o.aemNamespace)||void 0===s?void 0:s.pageEnvironmentVariables);return r&&d?Object.assign(Object.assign({},r),d):{}}getReducer(){return()=>this.initialState}getPublicDispatchers(){return{}}},L=()=>k(void 0,void 0,void 0,(function*(){var i;if(!(null===(i=window.top)||void 0===i?void 0:i.aemNamespace)&&!window.aemNamespace)return new Promise((i=>{let t;Object.defineProperty(window.top,"aemNamespace",{get:()=>t,set(e){return k(this,void 0,void 0,(function*(){t=e,i()}))}})}))})),N="@dh-io/datapump";class LocalAemSetup{static initializeAEMIfNeeded(){return i(this,void 0,void 0,(function*(){const i=o(N),t=window.top.seamlessStore.initializeStore();try{yield t.getConnection(O,1e3)}catch(t){i.log("----\x3e AEM environment missing from Seamless Store, adding the connection."),yield k(void 0,void 0,void 0,(function*(){const i=window.top.seamlessStore.initializeStore();return yield L(),yield k(void 0,void 0,void 0,(function*(){var i,t,e;if(!(null===(t=null===(i=window.top)||void 0===i?void 0:i.aemNamespace)||void 0===t?void 0:t.environmentVariables)&&!(null===(e=null===window||void 0===window?void 0:window.aemNamespace)||void 0===e?void 0:e.environmentVariables))return new Promise((i=>{var t;let e;Object.defineProperty(null===(t=window.top)||void 0===t?void 0:t.aemNamespace,"environmentVariables",{get:()=>e,set(t){e=t,i()}})}))})),yield k(void 0,void 0,void 0,(function*(){var i,t,e;if(!(null===(t=null===(i=window.top)||void 0===i?void 0:i.aemNamespace)||void 0===t?void 0:t.pageEnvironmentVariables)&&!(null===(e=null===window||void 0===window?void 0:window.aemNamespace)||void 0===e?void 0:e.pageEnvironmentVariables))return new Promise((i=>{var t;let e;Object.defineProperty(null===(t=window.top)||void 0===t?void 0:t.aemNamespace,"pageEnvironmentVariables",{get:()=>e,set(t){e=t,i()}})}))})),i.addConnection(M)}))}try{yield t.getConnection(d,1e3)}catch(t){i.log("----\x3e WKOs missing from Seamless Store, adding the connection."),yield s(void 0,void 0,void 0,(function*(){return window.top.seamlessStore.initializeStore().addConnection(c)})),function(){var i;const t=window.top||window;let e=null===(i=t.owc)||void 0===i?void 0:i.wkoManager;if(null==e&&t.aemNamespace){const i=new WKOManager;t.owc?t.owc.wkoManager=i:t.owc={wkoManager:i},e=t.owc.wkoManager}}()}}))}}class DataLayerFetcher{static getDataLayerByEvent(i){const t=this.dataLayer?this.dataLayer.filter((t=>t.event===i)):[],e=t[(null==t?void 0:t.length)-1];return e||{}}static setAffinity(i){const t=this.getDataLayerByEvent("pageview");this.dataLayer&&(t.page.affinity=i,this.dataLayer.push(this.getDataLayerByEvent("pageview")))}}DataLayerFetcher.dataLayer=window.dataLayer_ow,DataLayerFetcher.logger=o(N);class B2xFetcher{static getJweFromB2x(){var t;return i(this,void 0,void 0,(function*(){yield this.fetchJweToken((i=>i&&i.auth&&i.auth.jwe&&i.auth.jwe.length),5e3);const i=null===(t=this.b2xCoreLogin)||void 0===t?void 0:t.auth.jwe;if(null===i)return this.logger.log("JWE IS NULL"),Promise.resolve(void 0);switch(yield WkoFetcher.getStage()){case A.LOCAL:case A.TEST:case A.DEV:return this.logger.log("Using Test JWE"),Promise.resolve(this.TESTJWE)}return Promise.resolve(`Bearer ${i}`)}))}static getLoginStatusFromB2x(){var t,e,n;return i(this,void 0,void 0,(function*(){yield this.fetchLoggedInStatus((i=>i&&i.auth&&i.auth.isLoggedIn),5e3);const i=null===(e=null===(t=DataLayerFetcher.getDataLayerByEvent("global"))||void 0===t?void 0:t.user)||void 0===e?void 0:e.loginState,o=(null===(n=this.b2xCoreLogin)||void 0===n?void 0:n.auth.isLoggedIn)||!(i&&i.includes("out"));return!1===o||i&&i.includes("out")?(this.logger.log("LoggedIn Status is: ",o),Promise.resolve(!1)):(this.logger.log("LoggedIn Status is: ",o),Promise.resolve(o))}))}static fetchJweToken(t,e=0){return i(this,void 0,void 0,(function*(){return yield LocalAemSetup.initializeAEMIfNeeded(),t(this.b2xCoreLogin)?Promise.resolve():new Promise((i=>{0!==e&&setTimeout(i,e),this.store.subscribe(_.B2XCORE_LOGIN,(e=>{this.b2xCoreLogin=e,t(e)&&i()}))}))}))}static fetchLoggedInStatus(t,e=0){return i(this,void 0,void 0,(function*(){return yield LocalAemSetup.initializeAEMIfNeeded(),t(this.b2xCoreLogin)?Promise.resolve():new Promise((i=>{0!==e&&setTimeout(i,e),this.store.subscribe(_.B2XCORE_LOGIN,(e=>{this.b2xCoreLogin=e,t(e)&&i()}))}))}))}}var F,E;B2xFetcher.TESTJWE="00110207a62c4365",B2xFetcher.store=window.top.seamlessStore.initializeStore(),B2xFetcher.logger=o(N),function(i){i.GET="GET",i.POST="POST",i.PUT="PUT",i.DELETE="DELETE"}(F||(F={}));class APIService{static request(t,e,n,s){return i(this,void 0,void 0,(function*(){const r=o(N),d=yield WkoFetcher.getStage(),a=this.buildFullUrl(t,d),c=yield this.getHeaders(d,s),l=n?JSON.stringify(n):void 0,u={headers:c,method:e,body:l};return fetch(a.toString(),u).then((t=>i(this,void 0,void 0,(function*(){try{if(200===t.status){return yield t.json()}return r.log(t.status),{}}catch(i){return r.error(i),{}}}))))}))}static buildFullUrl(i,t){const e=this.getApiBaseUrl(t);return new URL(`${e}${i}`)}static getHeaders(t,e){return i(this,void 0,void 0,(function*(){let i=e;return i=e&&0!==e.length?e:yield B2xFetcher.getJweFromB2x(),Promise.resolve({Authorization:i,"Content-Type":"application/json"})}))}static getApiBaseUrl(i){const t="/api/v0";switch(i){case A.LOCAL:case A.TEST:case A.DEV:return"https://dev.api.oneweb.mercedes-benz.com/mbscore"+t;case A.INT:case A.PPROD:return"https://int.api.oneweb.mercedes-benz.com/mbscore"+t;case A.PROD:return"https://api.oneweb.mercedes-benz.com/mbscore"+t;default:throw new Error("Failed to get the stage environment.")}}}!function(i){i.POST_NBO="/fuv/nborecommendation",i.POST_AFFINITY="/affinity/score",i.POST_ONEDOC="/consent/onedoc",i.GET_LIVE_AFFINITY="/status/markets"}(E||(E={}));class WkoFetcher{static isUserConsentAccepted(){var t,e,n;return i(this,void 0,void 0,(function*(){try{if(yield this.isNonProd())return Promise.resolve(!0);const i=i=>i&&i.User&&i.User.consent&&null!=i.User.consent.enableDataUsages;return yield this.fetchWellKnownObjectsIfNeeded(i),Promise.resolve(!0===(null===(n=null===(e=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.User)||void 0===e?void 0:e.consent)||void 0===n?void 0:n.enableDataUsages))}catch(i){return Promise.resolve(!1)}}))}static checkDataUsageScopes(i){return!!(i&&i.length>0)&&i.every((i=>i.agreed))}static isOneDocAccepted(){return i(this,void 0,void 0,(function*(){try{const i=yield this.getFirstName(),t=yield this.getLastName(),e=yield this.getEmailAdress(),n=yield this.getMpc();if(!(i&&t&&e&&n))return Promise.resolve(!1);const o={country:n,firstname:i,lastname:t,email:e};return(yield APIService.request(E.POST_ONEDOC,F.POST,o)).onlinetracksm}catch(i){return Promise.resolve(!1)}}))}static isNonProd(){return i(this,void 0,void 0,(function*(){return(yield this.getStage())===A.PROD?Promise.resolve(!1):Promise.resolve(!0)}))}static checkIsLoggedIn(){return i(this,void 0,void 0,(function*(){return(yield WkoFetcher.getJweBearer(5e3))?Promise.resolve(!0):Promise.resolve(!1)}))}static getJweBearer(t=0){var e,n;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.Authentication&&i.Authentication.jwe),t);const i=null===(n=null===(e=this.wellKnowObjects)||void 0===e?void 0:e.Authentication)||void 0===n?void 0:n.jwe;if(!i)return Promise.resolve(void 0);switch(yield this.getStage()){case A.LOCAL:case A.TEST:case A.DEV:return this.logger.log("Using Test JWE"),Promise.resolve(this.TESTJWE)}return Promise.resolve(`Bearer ${i}`)}))}static getMpc(){var t,e;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.Locale&&i.Locale.country));const i=null===(e=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.Locale)||void 0===e?void 0:e.country;return i?Promise.resolve(i):(this.logger.log("No country available"),Promise.resolve(""))}))}static getLanguage(){var t,e;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.Locale&&i.Locale.language));const i=null===(e=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.Locale)||void 0===e?void 0:e.language;return i?Promise.resolve(i):(this.logger.log("No language available"),Promise.resolve(""))}))}static getStage(){var t,e,n,o;return i(this,void 0,void 0,(function*(){const i=null===(e=null===(t=DataLayerFetcher.getDataLayerByEvent("global"))||void 0===t?void 0:t.site)||void 0===e?void 0:e.sysEnv;if(!i){const i=i=>i&&i.Environment&&i.Environment.stage;yield this.fetchWellKnownObjectsIfNeeded(i)}const s=(null===(o=null===(n=this.wellKnowObjects)||void 0===n?void 0:n.Environment)||void 0===o?void 0:o.stage)||i;if(!s)throw new Error("Failed to get the stage.");return Promise.resolve(s)}))}static getFirstName(){var t,e,n;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.User&&i.User.personal&&i.User.personal&&i.User.personal.fistname),1e3);let i=null===(n=null===(e=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.User)||void 0===e?void 0:e.personal)||void 0===n?void 0:n.name;return i?(i=null==i?void 0:i.split(" ")[0],Promise.resolve(i)):(this.logger.log("No firstname available"),Promise.resolve(null))}))}static getLastName(){var t,e,n;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.User&&i.User.personal&&i.User.personal&&i.User.personal.lastname),1e3);const i=null===(n=null===(e=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.User)||void 0===e?void 0:e.personal)||void 0===n?void 0:n.lastname;return i?Promise.resolve(i):(this.logger.log("No lastname available"),Promise.resolve(null))}))}static getEmailAdress(){var t,e,n;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.User&&i.User.personal&&i.User.personal&&i.User.personal.email),1e3);const i=null===(n=null===(e=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.User)||void 0===e?void 0:e.personal)||void 0===n?void 0:n.email;return i?Promise.resolve(i):(this.logger.log("No email available"),Promise.resolve(null))}))}static getZipCode(){var t,e,n,o;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.User&&i.User.personal&&i.User.personal.wkoUserData&&i.User.personal.wkoUserData.zipCode),1e3);const i=null===(o=null===(n=null===(e=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.User)||void 0===e?void 0:e.personal)||void 0===n?void 0:n.wkoUserData)||void 0===o?void 0:o.zipCode;return i?Promise.resolve(i):(this.logger.log("No zipCode available"),Promise.resolve(null))}))}static getConsenList(){var t;return i(this,void 0,void 0,(function*(){yield this.fetchWellKnownObjectsIfNeeded((i=>i&&i.ConsentList),1e3);const i=null===(t=this.wellKnowObjects)||void 0===t?void 0:t.ConsentList;return i?Promise.resolve(i):(this.logger.log("No consentList available"),Promise.resolve([]))}))}static fetchWellKnownObjectsIfNeeded(t,e=0){return i(this,void 0,void 0,(function*(){return yield LocalAemSetup.initializeAEMIfNeeded(),t(this.wellKnowObjects)?Promise.resolve():new Promise((i=>{0!==e&&setTimeout(i,e),this.store.subscribe(d,(e=>{this.wellKnowObjects=e,t(e)&&i()}))}))}))}}WkoFetcher.TESTJWE="00110207a62c4365",WkoFetcher.store=window.top.seamlessStore.initializeStore(),WkoFetcher.logger=o(N);
/*! connection-aem-tracking 1.6.0-SNAPSHOT */
const T="OWC_TRACKING_MANAGER",D="PUSH_TRACKING_EVENT",C={trackingEvents:[]};new class extends window.top.seamlessStore.SeamlessConnection{constructor(){super(T)}get initialState(){return C}getReducer(){return(i=C,t)=>t.type===this.getActionType(D)?Object.assign(Object.assign({},i),{trackingEvents:[...i.trackingEvents,t.payload]}):i}getPublicDispatchers(){return{pushTrackingEvent:i=>{var t;return null===(t=window.top)||void 0===t||t.dataLayer_ow.push(i),this.getAction(D,i)}}}};const I=()=>window.top.seamlessStore.initializeStore().getConnectionDispatchers(T).then((i=>i)),$={};function B(i){for(const t in i)return!1;return!0}var W,U,x;$.de={button_online_shop:"Online kaufen",button_configurator:"Fahrzeug konfigurieren",button_product_page:"Mehr erfahren",button_test_drive:"Probefahrt vereinbaren",description:"Ihre persönliche Fahrzeugempfehlung: Jetzt entdecken."},$.nl={button_online_shop:"Online Showroom",button_configurator:"Configureren",button_product_page:"Ontdek meer",button_test_drive:"Testrit",description:"Omschrijving"},$.fr={button_online_shop:"Online Showroom",button_configurator:"Configurer",button_product_page:"En savoir plus",button_test_drive:"Faire un essai",description:"La description"},$.at={button_online_shop:"Online kaufen",button_configurator:"Fahrzeug konfigurieren",button_product_page:"Mehr erfahren",button_test_drive:"Probefahrt vereinbaren",description:"Ihre persönliche Fahrzeugempfehlung: Jetzt entdecken."},function(i){i.testDrives="testDrives",i.carConfigurations="carConfigurations",i.interests="interests",i.stockVehicles="stockVehicles"}(W||(W={})),function(i){i.low="low",i.medium="medium",i.high="high",i.higher="higher",i.highest="highest"}(U||(U={}));class TouchpointFetcher{static selectTouchpointsMm(t){return i(this,void 0,void 0,(function*(){yield this.fetchTouchpointsIfNeeded(5e3);const i=[];if(this.considTouchpoints){const e=this.considTouchpoints.touchpoints;for(const[n,o]of Object.entries(e)){const e=this.mapConsiderationTp(t,o,n);e&&i.push(e),this.logger.log(`${n}: ${o}`)}this.brokerTouchpoints=i}return Promise.resolve(i)}))}static getCurrentAction(){return i(this,void 0,void 0,(function*(){if(yield this.fetchTouchpointsIfNeeded(5e3),this.brokerTouchpoints){const i=this.getLatestCreationDate(this.brokerTouchpoints);if(null!=i)return Promise.resolve(i.touchpointName)}return this.logger.log("No touchpoints. Set broker touchpoints for current bm first!"),Promise.resolve(W.interests)}))}static mapConsiderationTp(i,t,e){return t.filter((t=>t.bm4===i)).map((i=>({touchpointName:e,touchpointTimestamp:i.creationDate})))[0]}static getInterestedBm4ListFromTochpointList(){var t,e;return i(this,void 0,void 0,(function*(){yield this.fetchTouchpointsIfNeeded(3e3);const i=null===(e=null===(t=this.considTouchpoints)||void 0===t?void 0:t.touchpoints)||void 0===e?void 0:e.interests;return(null==i?void 0:i.length)?(this.logger.log("intrestedLit",i),Promise.resolve(i.map((i=>{var t;return null===(t=null==i?void 0:i.bm4)||void 0===t?void 0:t.substring(0,4)}))||[])):(this.logger.log("No Interested List available!"),Promise.resolve([]))}))}static getRecentConfigFromcarConfiguration(){var t,e,n;return i(this,void 0,void 0,(function*(){yield this.fetchTouchpointsIfNeeded(5e3);const i=null===(e=null===(t=this.considTouchpoints)||void 0===t?void 0:t.touchpoints)||void 0===e?void 0:e.carConfigurations;return(null==i?void 0:i.length)?(this.logger.log("rescnt car configuration",i),Promise.resolve(null===(n=i[0].bm4)||void 0===n?void 0:n.substring(0,4))||""):(this.logger.log("No car Configuration available!"),Promise.resolve(""))}))}static fetchTouchpointsIfNeeded(t=0){return i(this,void 0,void 0,(function*(){yield LocalAemSetup.initializeAEMIfNeeded();const i=i=>i&&"succeeded"==i.touchpointStatus;return i(this.considTouchpoints)?Promise.resolve():new Promise((e=>{0!==t&&setTimeout(e,t),this.store.subscribe(_.TOUCHPOINTS,(t=>{this.considTouchpoints=t,i(t)&&e()}))}))}))}}TouchpointFetcher.store=window.top.seamlessStore.initializeStore(),TouchpointFetcher.logger=o(N),TouchpointFetcher.getLatestCreationDate=i=>i.length?i.reduce(((i,t)=>new Date(i.touchpointTimestamp).getTime()>new Date(t.touchpointTimestamp).getTime()?i:t)):null;class NBOManager{static generateImageSourceBaseOnWindow(i){const t=window.innerWidth;let e;switch(!0){case t<480:e=i.replace("{mq}","mq1");break;case t<768:e=i.replace("{mq}","mq2");break;case t<1024:e=i.replace("{mq}","mq3");break;case t<1280:e=i.replace("{mq}","mq4");break;case t<1440:e=i.replace("{mq}","mq5");break;default:e=i.replace("{mq}","mq6")}return e}static createPayload(i,t){var e,n,o,s,r,d,a,c,l,u,v,h,f,g,w,m,y,p,b,S,A;if(i&&!B(i)&&(null!=i.onlinestoreInfo||null!=i.configuratorInfo))return{headline:i.bmResources.vehicleHeadline,description:$[t].description,stageImage:{title:i.bmResources.vehicleHeadline,description:$[t].description,source:"https://www.mercedes-benz.at"+this.generateImageSourceBaseOnWindow(i.bmResources.vehicleImage)},buttons:[{label:(null===(e=i.saveToDashboardInfo)||void 0===e?void 0:e.label)?null===(n=i.saveToDashboardInfo)||void 0===n?void 0:n.label:(null===(o=i.onlinestoreInfo)||void 0===o?void 0:o.label)?null===(s=i.onlinestoreInfo)||void 0===s?void 0:s.label:(null===(r=i.configuratorInfo)||void 0===r?void 0:r.label)?null===(d=i.configuratorInfo)||void 0===d?void 0:d.label:$[t].button_online_shop,target:"_blank",type:i.onlinestoreInfo?"primary":void 0,url:(null===(a=i.saveToDashboardInfo)||void 0===a?void 0:a.url)?`${window.location.origin}/${i.saveToDashboardInfo.url}`:(null===(c=i.onlinestoreInfo)||void 0===c?void 0:c.url)?i.onlinestoreInfo.url:void 0},{label:(null===(l=i.saveToDashboardInfo)||void 0===l?void 0:l.label)?(null===(u=i.onlinestoreInfo)||void 0===u?void 0:u.label)?null===(v=i.onlinestoreInfo)||void 0===v?void 0:v.label:(null===(h=i.configuratorInfo)||void 0===h?void 0:h.label)?null===(f=i.configuratorInfo)||void 0===f?void 0:f.label:$[t].button_configurator:(null===(g=i.configuratorInfo)||void 0===g?void 0:g.label)?null===(w=i.configuratorInfo)||void 0===w?void 0:w.label:$[t].button_configurator,target:"_blank",type:i.onlinestoreInfo?"secondary":"primary",url:(null===(m=i.saveToDashboardInfo)||void 0===m?void 0:m.url)?(null===(y=i.onlinestoreInfo)||void 0===y?void 0:y.url)?null===(p=i.onlinestoreInfo)||void 0===p?void 0:p.url:(null===(b=i.configuratorInfo)||void 0===b?void 0:b.url)?i.configuratorInfo.url:void 0:(null===(S=i.configuratorInfo)||void 0===S?void 0:S.url)?null===(A=i.configuratorInfo)||void 0===A?void 0:A.url:void 0}]}}static setPersonalisationEngine(t){var e,n,o,s,r,d,a,c,l,u,v,h,f,g;return i(this,void 0,void 0,(function*(){const i=yield WkoFetcher.getMpc(),w=yield WkoFetcher.getLanguage(),m=yield B2xFetcher.getJweFromB2x(),y=yield TouchpointFetcher.getRecentConfigFromcarConfiguration(),p=yield TouchpointFetcher.getInterestedBm4ListFromTochpointList();if(this.logger.log("This is from Wishlist",y),"AT"==i&&m){const m=yield APIService.request(E.POST_NBO,F.POST,{mpc:i,language:w,wishlistBm:y,intrestedBms:p,rp:t});if(this.sendAnalyticsTrackingEvent(void 0,void 0,null===(e=m.bmResources)||void 0===e?void 0:e.modelCode),this.logger.log(`after calling nborecommendation with response = ${JSON.stringify(m)}`),m&&!B(m)){const i=(null===(n=m.saveToDashboardInfo)||void 0===n?void 0:n.label)?null===(o=m.saveToDashboardInfo)||void 0===o?void 0:o.label:(null===(s=m.onlinestoreInfo)||void 0===s?void 0:s.label)?null===(r=m.onlinestoreInfo)||void 0===r?void 0:r.label:(null===(d=m.configuratorInfo)||void 0===d?void 0:d.label)?null===(a=m.configuratorInfo)||void 0===a?void 0:a.label:$[w].button_online_shop,t=(null===(c=m.saveToDashboardInfo)||void 0===c?void 0:c.label)?(null===(l=m.onlinestoreInfo)||void 0===l?void 0:l.label)?null===(u=m.onlinestoreInfo)||void 0===u?void 0:u.label:(null===(v=m.configuratorInfo)||void 0===v?void 0:v.label)?null===(h=m.configuratorInfo)||void 0===h?void 0:h.label:$[w].button_configurator:(null===(f=m.configuratorInfo)||void 0===f?void 0:f.label)?null===(g=m.configuratorInfo)||void 0===g?void 0:g.label:$[w].button_configurator,e=this.createPayload(m,w);if(e&&!B(e)){document.querySelector("owc-stage").personalisation(e),setTimeout((()=>{this.gtmStageClick(i,t,m.bmResources.modelCode)}),500)}}}}))}static gtmStageClick(i,t,e){const n=document.querySelector("owc-stage").shadowRoot.querySelector(".owc-stage"),o=n.querySelector(".owc-stage-cta-buttons__button--primary"),s=n.querySelector(".owc-stage-cta-buttons__button--secondary");null!=o&&this.sendAnalyticsTrackingEvent(o,i,e),null!=s&&this.sendAnalyticsTrackingEvent(s,t,e)}static sendAnalyticsTrackingEvent(i,t,e){const n={event:"click",application:{id:"mb_score",version:"0.2"},eventDetail:{category:"impression",action:"Target",label:"stageteaser_active",target:{type:"mvp_experience-targeting_manual",campaign:"follow-up-vehicle",format:"stage-teaser",experience:"target",vehicle:e,trigger:"retention-period-plus2.5y"}}};if(void 0===i&&void 0===t){const i=n;NBOManager.logger.log(`${JSON.stringify(i)}`),I().then((t=>{t.pushTrackingEvent(i)})),NBOManager.logger.log("impression event/if block")}else t=null==t?void 0:t.toLowerCase().replace(".","").replace(/\s/g,"_"),n.eventDetail.category="click",n.eventDetail.label=t,NBOManager.logger.log("click event/else block");const o=n;null==i||i.addEventListener("click",(function(){NBOManager.logger.log(`${JSON.stringify(o)}`),I().then((i=>{i.pushTrackingEvent(o)}))}))}}NBOManager.logger=o(N),NBOManager.store=window.top.seamlessStore.initializeStore(),function(i){i.SET_AFFINITY_SCORE="AFFINITY_SCORE/SET_AFFINITY_SCORE"}(x||(x={}));const j=i=>({type:x.SET_AFFINITY_SCORE,state:i}),V=t=>e=>i(void 0,void 0,void 0,(function*(){e(j({affinityScore:t}))}));class AffinityScoreConnection extends window.top.seamlessStore.SeamlessConnection{constructor(){super(P.AFFINITY_SCORE)}get initialState(){return R}getReducer(){return z}getPublicDispatchers(){return{setAffinityScore:j,saveAffinityScoreToStore:V}}}const R={affinityScore:void 0},z=(i,t)=>t.type===x.SET_AFFINITY_SCORE?Object.assign(Object.assign({},i),t.state):i;let J;const q=new Uint8Array(16);function H(){if(!J&&(J="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!J))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return J(q)}const K=[];for(let i=0;i<256;++i)K.push((i+256).toString(16).slice(1));var G,Y={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function X(i,t,e){if(Y.randomUUID&&!t&&!i)return Y.randomUUID();const n=(i=i||{}).random||(i.rng||H)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){e=e||0;for(let i=0;i<16;++i)t[e+i]=n[i];return t}return function(i,t=0){return(K[i[t+0]]+K[i[t+1]]+K[i[t+2]]+K[i[t+3]]+"-"+K[i[t+4]]+K[i[t+5]]+"-"+K[i[t+6]]+K[i[t+7]]+"-"+K[i[t+8]]+K[i[t+9]]+"-"+K[i[t+10]]+K[i[t+11]]+K[i[t+12]]+K[i[t+13]]+K[i[t+14]]+K[i[t+15]]).toLowerCase()}(n)}class AffinityManager{static setAffinityScoreDispatcher(){return i(this,void 0,void 0,(function*(){var t;yield i(void 0,void 0,void 0,(function*(){t||(t=window.top.seamlessStore.initializeStore()),t.addConnection(new AffinityScoreConnection)})),AffinityManager.affinityScoreDispatcher=yield AffinityManager.store.getConnectionDispatchers(P.AFFINITY_SCORE)}))}static getCookieValue(){return AffinityManager.cookieMatch||(AffinityManager.cookieMatch=`; ${document.cookie}`.match(`;\\s*${AffinityManager.cookieName}=([^;]+)`)),AffinityManager.cookieMatch?AffinityManager.cookieMatch[1]:AffinityManager.createCookie().mb_score}static createCookie(){try{const i=new Date;i.setFullYear(i.getFullYear()+1);const t=i.toUTCString(),e=X();document.cookie=`${AffinityManager.cookieName}=${e}; path=/; domain=${window.location.hostname}; expires=${t};`;const n={};document.cookie.split(/\s*;\s*/).forEach((i=>{const t=i.split(/\s*=\s*/);n[t[0]]=t.splice(1).join("=")}));return n}catch(i){return this.logger.error(i),""}}static getConsentListOfWko(){return i(this,void 0,void 0,(function*(){return yield WkoFetcher.getConsenList()}))}static isCookieEnabled(t){return i(this,void 0,void 0,(function*(){const i=JSON.parse(window.sessionStorage.ow_aem_consentList)||"[]";let e=i;0===i.length&&(e=yield this.getConsentListOfWko());const n=e.find((i=>i.name===t));return null==n?void 0:n.enabled}))}static hasBm(i){return i.baumuster&&null!==i.baumuster.length}static isDuplicatePageViewEvent(i){return JSON.stringify(AffinityManager.scoredPageviewRequest)===JSON.stringify(i)}static getLiveAffinityMarkets(){return i(this,void 0,void 0,(function*(){return(yield APIService.request(E.GET_LIVE_AFFINITY,F.GET))||{}}))}}G=AffinityManager,AffinityManager.logger=o(N),AffinityManager.store=window.top.seamlessStore.initializeStore(),AffinityManager.cookieName="mb_score",AffinityManager.sessionName=["Mercedes-Benz_Product_Affinity_Score","Mercedes-Benz_Data-Sharing"],AffinityManager.cookieMatch=null,AffinityManager.calcAffinityScore=(t,e)=>i(void 0,void 0,void 0,(function*(){var i,t,n,o,s;const r=yield WkoFetcher.getMpc(),d=yield WkoFetcher.getLanguage(),a=yield AffinityManager.isCookieEnabled(G.sessionName[0]),c=yield AffinityManager.isCookieEnabled(G.sessionName[1]);if(a&&c){const a=null!=e?e:yield AffinityManager.getLiveAffinityMarkets();if(null===(i=null==a?void 0:a.affinityScore)||void 0===i?void 0:i.find((i=>i===r))){const i=DataLayerFetcher.getDataLayerByEvent("pageview").page,e={pageName:i.name,pageType:i.type,baumuster:(null===(t=i.vehicle)||void 0===t?void 0:t.baumusterId)?null===(n=i.vehicle)||void 0===n?void 0:n.baumusterId:null===(o=i.vehicle)||void 0===o?void 0:o.modelCode,market:r,language:d};if(!AffinityManager.isDuplicatePageViewEvent(e)&&(AffinityManager.hasBm(e)||Z())){AffinityManager.scoredPageviewRequest=e;let i="";i="Bearer "+AffinityManager.getCookieValue(),AffinityManager.logger.log("calling POST_AFFINITY");const t=yield APIService.request(E.POST_AFFINITY,F.POST,e,i);AffinityManager.affinityScoreDispatcher||(yield AffinityManager.setAffinityScoreDispatcher()),null===(s=AffinityManager.affinityScoreDispatcher)||void 0===s||s.saveAffinityScoreToStore(t)}}}}));const Z=()=>!!document.querySelector("owc-stage");o(N);const Q=t=>i(void 0,void 0,void 0,(function*(){(yield B2xFetcher.getLoginStatusFromB2x())||AffinityManager.calcAffinityScore(t)})),ii=o(N);function ti(t){return i(this,void 0,void 0,(function*(){Q(t)}))}i(void 0,void 0,void 0,(function*(){return Z()&&(yield B2xFetcher.getLoginStatusFromB2x(),yield WkoFetcher.isNonProd()),Promise.resolve(!1)})).then((t=>{t&&i(void 0,void 0,void 0,(function*(){console.log("Entering setNboPersonsalistion"),NBOManager.setPersonalisationEngine()}))})),AffinityManager.setAffinityScoreDispatcher();let ei="";new MutationObserver((function(i){location.href!==ei&&(ei=location.href,ii.log(`URL change to ${location.href}`),ti())})).observe(document,{subtree:!0,childList:!0}),window.datapump={calculateAffinityScore:ti};export{ti as calculateAffinityScore};
//# sourceMappingURL=index.js.map
